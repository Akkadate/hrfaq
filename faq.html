ผมขอโทษที่โค้ดแสดงไม่ครบถ้วน นี่คือโค้ดฉบับเต็มที่ปรับปรุงแล้วซึ่งคุณสามารถคัดลอกไปใช้งานได้เลย:

```html
<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ระบบคำถามที่พบบ่อย - ระบบบริหารงานบุคคล V2</title>
    <!-- เพิ่ม Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- ไอคอน -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #3182ce;
            --primary-light: #63b3ed;
            --primary-dark: #2c5282;
            --secondary-color: #e53e3e;
            --background-color: #f7fafc;
            --sidebar-color: #1a202c;
            --sidebar-hover: #2d3748;
            --text-light: #f7fafc;
            --text-dark: #1a202c;
            --text-gray: #718096;
            --border-color: #e2e8f0;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-inner: inset 0 2px 4px 0 rgba(0, 0, 0, 0.06);
            --transition-speed: 0.3s;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Sarabun', sans-serif;
        }
        
        body {
            background-color: var(--background-color);
            min-height: 100vh;
            color: var(--text-dark);
            line-height: 1.6;
        }
        
        .container {
            display: flex;
            min-height: 100vh;
            flex-direction: column;
            position: relative;
        }
        
        @media (min-width: 768px) {
            .container {
                flex-direction: row;
            }
        }
        
        /* Header Bar */
        .header {
            background-color: white;
            box-shadow: var(--shadow-md);
            padding: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .header-title {
            color: var(--primary-dark);
            font-size: 1.5rem;
            font-weight: 600;
        }
        
        .header-logo {
            width: 40px;
            height: 40px;
            background-color: var(--primary-color);
            border-radius: 50%;
            margin-right: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
        }
        
        /* Sidebar */
        .sidebar {
            background-color: var(--sidebar-color);
            color: var(--text-light);
            padding: 1.5rem;
            width: 100%;
            box-shadow: var(--shadow-md);
            transition: all var(--transition-speed) ease;
            z-index: 5;
        }
        
        @media (min-width: 768px) {
            .sidebar {
                width: 300px;
                min-width: 300px;
                height: 100vh;
                position: sticky;
                top: 0;
            }
        }
        
        .sidebar h2 {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
        }
        
        .sidebar h2 i {
            margin-right: 0.75rem;
            color: var(--primary-light);
        }
        
        .category-list {
            list-style-type: none;
        }
        
        .category-item {
            margin-bottom: 0.5rem;
            padding: 0.75rem 1rem;
            border-radius: 0.375rem;
            cursor: pointer;
            transition: background-color var(--transition-speed), transform 0.2s;
            display: flex;
            align-items: center;
        }
        
        .category-item i {
            margin-right: 0.75rem;
            font-size: 0.875rem;
            opacity: 0.7;
        }
        
        .category-item:hover {
            background-color: var(--sidebar-hover);
            transform: translateX(5px);
        }
        
        .category-item.active {
            background-color: var(--primary-color);
            font-weight: 500;
            position: relative;
            transform: translateX(0);
        }
        
        .category-item.active i {
            opacity: 1;
        }
        
        .category-item.active::before {
            content: '';
            position: absolute;
            left: -1.5rem;
            width: 0.25rem;
            height: 100%;
            background-color: var(--primary-light);
        }
        
        /* Content Area */
        .content {
            padding: 2rem;
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .content h2 {
            font-size: 1.75rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            color: var(--primary-dark);
            border-bottom: 2px solid var(--primary-light);
            padding-bottom: 0.5rem;
            display: inline-block;
        }
        
        /* Intro Card */
        .intro-card {
            background-color: white;
            border-radius: 0.75rem;
            padding: 2rem;
            box-shadow: var(--shadow-md);
            margin-bottom: 2rem;
            border-top: 5px solid var(--primary-color);
            transition: transform var(--transition-speed);
        }
        
        .intro-card:hover {
            transform: translateY(-5px);
        }
        
        .intro-card h2 {
            margin-bottom: 1.25rem;
            display: flex;
            align-items: center;
            border-bottom: none;
        }
        
        .intro-card h2 i {
            margin-right: 0.75rem;
            color: var(--primary-color);
        }
        
        .intro-card p {
            margin-bottom: 1rem;
            line-height: 1.7;
            color: var(--text-gray);
        }
        
        .intro-info {
            margin-top: 1.5rem;
            padding: 1.5rem;
            background-color: rgba(66, 153, 225, 0.1);
            border-radius: 0.5rem;
            border-left: 4px solid var(--primary-color);
        }
        
        .intro-info h3 {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: var(--primary-dark);
            display: flex;
            align-items: center;
        }
        
        .intro-info h3 i {
            margin-right: 0.5rem;
            color: var(--primary-color);
        }
        
        .intro-info ul {
            list-style-type: none;
        }
        
        .intro-info li {
            margin-bottom: 0.75rem;
            padding-left: 1.5rem;
            position: relative;
        }
        
        .intro-info li::before {
            content: '•';
            position: absolute;
            left: 0;
            color: var(--primary-color);
            font-weight: bold;
        }
        
        /* Questions Container */
        .questions-container {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .question-card {
            background-color: white;
            border-radius: 0.75rem;
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
            transition: all var(--transition-speed);
        }
        
        .question-card:hover {
            box-shadow: var(--shadow-md);
        }
        
        .question-header {
            padding: 1.25rem;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color var(--transition-speed);
            border-left: 0 solid var(--primary-color);
        }
        
        .question-header:hover {
            background-color: rgba(237, 242, 247, 0.8);
        }
        
        .question-title {
            font-size: 1.125rem;
            font-weight: 500;
            line-height: 1.4;
            color: var(--text-dark);
            flex: 1;
            padding-right: 1rem;
        }
        
        .question-icon {
            color: var(--primary-color);
            font-size: 1.2rem;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all var(--transition-speed);
        }
        
        .question-answer {
            padding: 0;
            max-height: 0;
            overflow: hidden;
            background-color: rgba(247, 250, 252, 0.8);
            transition: all var(--transition-speed);
            border-top: 0 solid var(--border-color);
        }
        
        .question-answer.active {
            padding: 1.5rem;
            max-height: 1000px;
            border-top: 1px solid var(--border-color);
        }
        
        .question-answer-content {
            line-height: 1.7;
        }
        
        .question-answer-content b, 
        .question-answer-content strong {
            color: var(--primary-dark);
        }
        
        .question-card.active .question-header {
            border-left: 5px solid var(--primary-color);
            background-color: rgba(235, 244, 255, 0.5);
        }
        
        .question-card.active .question-icon {
            transform: rotate(180deg);
            background-color: var(--primary-color);
            color: white;
        }
        
        /* Loading and error states */
        .loading {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 70vh;
            gap: 1.5rem;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(66, 153, 225, 0.3);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .loading-text {
            font-size: 1.125rem;
            color: var(--text-gray);
            font-weight: 500;
        }
        
        .error {
            color: var(--secondary-color);
            padding: 1.5rem;
            background-color: rgba(254, 215, 215, 0.5);
            border-radius: 0.5rem;
            border-left: 4px solid var(--secondary-color);
            display: flex;
            align-items: center;
        }
        
        .error i {
            margin-right: 0.75rem;
            font-size: 1.5rem;
        }
        
        .empty-message {
            color: var(--text-gray);
            text-align: center;
            padding: 2rem;
            font-style: italic;
        }
        
        /* Responsive adjustments */
        @media (max-width: 640px) {
            .content {
                padding: 1.25rem;
            }
            
            .intro-card,
            .question-header {
                padding: 1.25rem;
            }
            
            .question-answer.active {
                padding: 1.25rem;
            }
            
            .header-title {
                font-size: 1.25rem;
            }
        }
        
        /* Dark mode option */
        .theme-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 45px;
            height: 45px;
            background-color: var(--primary-color);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: var(--shadow-lg);
            z-index: 100;
            transition: all var(--transition-speed);
        }
        
        .theme-toggle:hover {
            transform: rotate(30deg);
            background-color: var(--primary-dark);
        }
        
        /* Footer */
        .footer {
            text-align: center;
            padding: 2rem;
            background-color: white;
            border-top: 1px solid var(--border-color);
            color: var(--text-gray);
            font-size: 0.875rem;
        }

        /* ดาร์กโหมด */
        body.dark-mode {
            --background-color: #1a202c;
            --text-dark: #f7fafc;
            --text-gray: #cbd5e0;
            --border-color: #2d3748;
        }
        
        body.dark-mode .header,
        body.dark-mode .intro-card,
        body.dark-mode .question-card,
        body.dark-mode .footer {
            background-color: #2d3748;
            color: var(--text-light);
        }
        
        body.dark-mode .intro-info {
            background-color: rgba(66, 153, 225, 0.05);
        }
        
        body.dark-mode .question-header:hover {
            background-color: rgba(45, 55, 72, 0.8);
        }
        
        body.dark-mode .question-answer {
            background-color: rgba(26, 32, 44, 0.8);
        }
        
        body.dark-mode .question-card.active .question-header {
            background-color: rgba(44, 82, 130, 0.2);
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-logo">
            <i class="fas fa-users"></i>
        </div>
        <div class="header-title">ระบบคำถามที่พบบ่อย - ระบบบริหารงานบุคคล</div>
    </div>
    
    <div class="container">
        <div class="sidebar">
            <h2><i class="fas fa-th-list"></i> หมวดหมู่คำถาม</h2>
            <ul id="categoryList" class="category-list">
                <li class="category-item active" data-group="all">
                    <i class="fas fa-home"></i> ทั้งหมด
                </li>
                <!-- ข้อมูลหมวดหมู่เพิ่มเติมจะถูกเพิ่มที่นี่ -->
            </ul>
        </div>
        
        <div class="content">
            <div id="loadingIndicator" class="loading">
                <div class="loading-spinner"></div>
                <div class="loading-text">กำลังโหลดข้อมูล...</div>
            </div>
            
            <div id="errorIndicator" class="error" style="display: none;">
                <i class="fas fa-exclamation-circle"></i>
                <span id="errorText">เกิดข้อผิดพลาดในการโหลดข้อมูล</span>
            </div>
            
            <div id="contentArea" style="display: none;">
                <div id="introContent" class="intro-card">
                    <h2><i class="fas fa-info-circle"></i> คำถามที่พบบ่อยของระบบบริหารงานบุคคล</h2>
                    <p>ยินดีต้อนรับสู่ระบบคำถามที่พบบ่อยของระบบบริหารงานบุคคล เว็บไซต์นี้ได้รวบรวมคำถามและคำตอบที่พบบ่อยเกี่ยวกับการใช้งานระบบ</p>
                    <p>ในหน้านี้ คุณจะพบคำตอบสำหรับคำถามพื้นฐานและวิธีการใช้งานฟังก์ชันต่างๆ ของระบบบริหารงานบุคคล หากมีข้อสงสัยเพิ่มเติม โปรดติดต่อฝ่ายทรัพยากรบุคคล</p>
                    
                    <div class="intro-info">
                        <h3><i class="fas fa-lightbulb"></i> การใช้งานเว็บไซต์</h3>
                        <ul>
                            <li>คลิกที่หมวดหมู่ในเมนูด้านซ้ายเพื่อดูคำถามในหมวดนั้น</li>
                            <li>คลิกที่คำถามเพื่อดูคำตอบโดยละเอียด</li>
                            <li>คำตอบสามารถแสดงรูปภาพ ลิงก์ และรายละเอียดอื่นๆ ได้</li>
                            <li>คุณสามารถกลับไปดูคำถามทั้งหมดได้โดยคลิกที่ "ทั้งหมด" ในเมนูด้านซ้าย</li>
                        </ul>
                    </div>
                </div>
                
                <div id="questionsContent" style="display: none;">
                    <h2 id="questionsTitle"><i class="fas fa-question-circle"></i> คำถามทั้งหมด</h2>
                    <div id="questionsContainer" class="questions-container">
                        <!-- คำถามจะถูกเพิ่มที่นี่ -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="footer">
        &copy; 2025 ระบบบริหารงานบุคคล. สงวนลิขสิทธิ์.
    </div>
    
    <div class="theme-toggle" id="themeToggle">
        <i class="fas fa-moon"></i>
    </div>

    <script>
        // ข้อมูลตัวอย่าง - ใช้ในกรณีที่ไม่สามารถเชื่อมต่อกับ API ได้
        const demoData = [
            {
                id: 1,
                question: "ฉันจะตรวจสอบวันลาคงเหลือของฉันได้อย่างไร?",
                answer: "คุณสามารถตรวจสอบวันลาคงเหลือได้โดยเข้าไปที่เมนู <b>ข้อมูลส่วนตัว</b> > <b>ประวัติการลา</b> ระบบจะแสดงจำนวนวันลาประเภทต่างๆ ที่คุณใช้ไปแล้วและที่เหลืออยู่ในปีปัจจุบัน",
                group: "การลางาน"
            },
            {
                id: 2,
                question: "การขออนุมัติลาล่วงหน้ามีขั้นตอนอย่างไร?",
                answer: "การขออนุมัติลาล่วงหน้ามีขั้นตอนดังนี้:<br>1. เข้าสู่ระบบ<br>2. เลือกเมนู 'ยื่นใบลา'<br>3. เลือกประเภทการลา<br>4. กรอกข้อมูลวันที่ต้องการลาและเหตุผล<br>5. กดปุ่ม 'ส่งคำขอ'<br><br>ผู้บังคับบัญชาจะได้รับการแจ้งเตือนและดำเนินการอนุมัติต่อไป",
                group: "การลางาน"
            },
            {
                id: 3,
                question: "ฉันจะอัปโหลดใบรับรองแพทย์ได้อย่างไร?",
                answer: "หลังจากยื่นใบลาป่วยในระบบแล้ว คุณสามารถอัปโหลดใบรับรองแพทย์ได้โดย:<br>1. เข้าไปที่เมนู 'ประวัติการลา'<br>2. ค้นหาและคลิกที่รายการลาป่วยที่ต้องการแนบเอกสาร<br>3. คลิกที่ปุ่ม 'อัปโหลดเอกสาร'<br>4. เลือกไฟล์ใบรับรองแพทย์จากเครื่องคอมพิวเตอร์ของคุณ (รองรับไฟล์ .pdf, .jpg, .png)<br>5. คลิกยืนยัน",
                group: "การลางาน"
            },
            {
                id: 4,
                question: "เงินเดือนของฉันจะเข้าเมื่อไหร่?",
                answer: "เงินเดือนจะเข้าบัญชีธนาคารที่ท่านแจ้งไว้ทุกวันสิ้นเดือน หากตรงกับวันหยุด จะโอนเข้าในวันทำการสุดท้ายก่อนวันสิ้นเดือน สำหรับพนักงานใหม่ที่เริ่มงานระหว่างเดือน จะได้รับเงินเดือนตามสัดส่วนวันทำงานจริง",
                group: "เงินเดือนและสวัสดิการ"
            },
            {
                id: 5,
                question: "ฉันจะดูรายละเอียดสลิปเงินเดือนได้อย่างไร?",
                answer: "คุณสามารถดูรายละเอียดสลิปเงินเดือนได้โดย:<br>1. เข้าสู่ระบบ<br>2. เลือกเมนู 'เงินเดือนและสวัสดิการ'<br>3. เลือก 'สลิปเงินเดือน'<br>4. เลือกเดือนที่ต้องการดูข้อมูล<br><br>สลิปเงินเดือนจะแสดงรายละเอียดรายรับ รายหัก และยอดสุทธิที่ได้รับ",
                group: "เงินเดือนและสวัสดิการ"
            },
            {
                id: 6,
                question: "วิธีแก้ไขข้อมูลส่วนตัวในระบบ",
                answer: "การแก้ไขข้อมูลส่วนตัวในระบบ:<br>1. เข้าสู่ระบบ<br>2. คลิกที่ชื่อผู้ใช้ของคุณที่มุมขวาบน<br>3. เลือก 'ข้อมูลส่วนตัว'<br>4. คลิกปุ่ม 'แก้ไข' ที่ข้อมูลที่ต้องการเปลี่ยนแปลง<br>5. กรอกข้อมูลใหม่<br>6. กดปุ่ม 'บันทึก'<br><br>หมายเหตุ: ข้อมูลบางประเภท เช่น เลขบัตรประชาชน หรือวันเกิด อาจไม่สามารถแก้ไขได้ด้วยตนเอง ต้องติดต่อฝ่ายทรัพยากรบุคคล",
                group: "ข้อมูลส่วนตัว"
            },
            {
                id: 7,
                question: "การเปลี่ยนรหัสผ่านทำอย่างไร?",
                answer: "การเปลี่ยนรหัสผ่านมีขั้นตอนดังนี้:<br>1. เข้าสู่ระบบ<br>2. คลิกที่ชื่อผู้ใช้ของคุณที่มุมขวาบน<br>3. เลือก 'ตั้งค่าความปลอดภัย'<br>4. เลือก 'เปลี่ยนรหัสผ่าน'<br>5. กรอกรหัสผ่านปัจจุบัน<br>6. กรอกรหัสผ่านใหม่ และยืนยันรหัสผ่านใหม่<br>7. คลิก 'บันทึก'<br><br>รหัสผ่านใหม่ต้องมีความยาวอย่างน้อย 8 ตัวอักษร ประกอบด้วยตัวอักษรภาษาอังกฤษตัวใหญ่ ตัวเล็ก ตัวเลข และอักขระพิเศษ",
                group: "ความปลอดภัยและการเข้าสู่ระบบ"
            },
            {
                id: 8,
                question: "ฉันลืมรหัสผ่าน จะทำอย่างไร?",
                answer: "หากคุณลืมรหัสผ่าน สามารถดำเนินการดังนี้:<br>1. ที่หน้าเข้าสู่ระบบ คลิก 'ลืมรหัสผ่าน'<br>2. กรอกอีเมลที่ใช้ลงทะเบียนในระบบ<br>3. คลิก 'ส่งลิงก์รีเซ็ตรหัสผ่าน'<br>4. เช็คอีเมลของคุณและคลิกลิงก์ที่ได้รับ<br>5. ตั้งรหัสผ่านใหม่ตามข้อกำหนด<br><br>หากไม่ได้รับอีเมล โปรดตรวจสอบโฟลเดอร์ 'จดหมายขยะ' หรือติดต่อฝ่ายทรัพยากรบุคคลที่เบอร์ 02-123-4567",
                group: "ความปลอดภัยและการเข้าสู่ระบบ"
            }
        ];

        // เพิ่มข้อมูลไอคอนสำหรับแต่ละหมวดหมู่
        const groupIcons = {
           "การลางาน": "fas fa-calendar-alt",
            "เงินเดือนและสวัสดิการ": "fas fa-money-bill-wave",
            "ข้อมูลส่วนตัว": "fas fa-user-edit",
            "ความปลอดภัยและการเข้าสู่ระบบ": "fas fa-shield-alt"
        };

        // DOM Elements
        const categoryList = document.getElementById('categoryList');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const errorIndicator = document.getElementById('errorIndicator');
        const errorText = document.getElementById('errorText');
        const contentArea = document.getElementById('contentArea');
        const introContent = document.getElementById('introContent');
        const questionsContent = document.getElementById('questionsContent');
        const questionsTitle = document.getElementById('questionsTitle');
        const questionsContainer = document.getElementById('questionsContainer');
        const themeToggle = document.getElementById('themeToggle');

        // State variables
        let questions = [];
        let groups = [];
        let selectedGroup = 'all';
        let expandedQuestionId = null;
        let useLocalData = false;
        let isDarkMode = false;

        // Supabase configuration
        const supabaseUrl = 'https://ecpbvoijdtgkaabuglmw.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVjcGJ2b2lqZHRna2FhYnVnbG13Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDA4MzkzMDEsImV4cCI6MjA1NjQxNTMwMX0.391_WbnnNWxAB55h5Br4gfFu4c3m65o9x-XPIx4R-WA';

        // กำหนดเวลาหมดเวลา (timeout) สำหรับการเชื่อมต่อ
        const FETCH_TIMEOUT = 5000; // 5 วินาที

        // ใช้ข้อมูลตัวอย่างทันที
        function useDemo() {
            questions = demoData;
            useLocalData = true;
            
            // ดึงกลุ่มที่ไม่ซ้ำกันจากข้อมูลตัวอย่าง
            const uniqueGroupsSet = new Set();
            questions.forEach(item => {
                if (item.group) {
                    uniqueGroupsSet.add(item.group);
                }
            });
            groups = Array.from(uniqueGroupsSet);
            
            console.log('Using demo data due to timeout or error');
            console.log('Demo groups:', groups);
            
            // แสดงเนื้อหา
            finishLoading();
        }

        // Function with timeout for fetching data
        function fetchWithTimeout(url, options, timeout = FETCH_TIMEOUT) {
            return Promise.race([
                fetch(url, options),
                new Promise((_, reject) => 
                    setTimeout(() => reject(new Error('Request timeout')), timeout)
                )
            ]);
        }

        // Function to fetch data from Supabase
        async function fetchFromSupabase(endpoint, options = {}) {
            const url = `${supabaseUrl}/rest/v1/${endpoint}`;
            const headers = {
                'apikey': supabaseKey,
                'Authorization': `Bearer ${supabaseKey}`,
                'Content-Type': 'application/json',
                'Prefer': 'return=representation',
                ...options.headers
            };

            try {
                console.log('Fetching from:', url);
                const response = await fetchWithTimeout(url, {
                    ...options,
                    headers
                }, FETCH_TIMEOUT);

                if (!response.ok) {
                    throw new Error(`Supabase API error: ${response.status} ${response.statusText}`);
                }

                const data = await response.json();
                console.log('Data fetched successfully:', data.length, 'records');
                return data;
            } catch (error) {
                console.error('Error fetching from Supabase:', error);
                throw error;
            }
        }

        // ฟังก์ชันแสดงเนื้อหาหลังการโหลดเสร็จสิ้น
        function finishLoading() {
            // ซ่อนตัวแสดงการโหลดและแสดงเนื้อหา
            loadingIndicator.style.display = 'none';
            contentArea.style.display = 'block';
            
            // อัปเดตรายการหมวดหมู่
            populateCategoryList();
            
            // แสดงคำแนะนำเริ่มต้น
            showIntroduction();
        }

        // Initialize the application
        async function initApp() {
            try {
                // แสดง loading indicator
                loadingIndicator.style.display = 'flex';
                errorIndicator.style.display = 'none';
                contentArea.style.display = 'none';
                
                // ตั้งค่า timeout เพื่อให้ไม่ค้างอยู่ที่การโหลด
                const timeoutId = setTimeout(() => {
                    console.log('Loading timeout reached, using demo data');
                    useDemo();
                }, FETCH_TIMEOUT);
                
                try {
                    // พยายามดึงข้อมูลจาก Supabase ด้วยชื่อตาราง "faq"
                    const data = await fetchFromSupabase('faq', {
                        method: 'GET',
                        headers: {
                            'Range': '0-999',
                            'Prefer': 'count=exact',
                        }
                    });
                    
                    // ยกเลิก timeout เมื่อดึงข้อมูลสำเร็จ
                    clearTimeout(timeoutId);
                    
                    questions = data || [];
                    useLocalData = false;
                    
                    // ดึงกลุ่มที่ไม่ซ้ำกันจากข้อมูล
                    const uniqueGroupsSet = new Set();
                    questions.forEach(item => {
                        if (item.group) {
                            uniqueGroupsSet.add(item.group);
                        }
                    });
                    groups = Array.from(uniqueGroupsSet);
                    
                    console.log('Data loaded from Supabase:', questions.length, 'records');
                    console.log('Groups:', groups);
                    
                    // แสดงเนื้อหา
                    finishLoading();
                    
                } catch (fetchError) {
                    // ยกเลิก timeout เมื่อเกิดข้อผิดพลาด
                    clearTimeout(timeoutId);
                    console.error('Error fetching data:', fetchError);
                    
                    // ใช้ข้อมูลตัวอย่าง
                    useDemo();
                }
                
            } catch (err) {
                console.error('Error setting up application:', err);
                loadingIndicator.style.display = 'none';
                errorIndicator.textContent = 'เกิดข้อผิดพลาดในการโหลดข้อมูล: ' + err.message;
                errorIndicator.style.display = 'block';
                
                // ยังคงพยายามแสดงข้อมูลตัวอย่าง
                useDemo();
                contentArea.style.display = 'block';
            }

            // เพิ่ม event listener สำหรับปุ่มสลับธีม
            themeToggle.addEventListener('click', toggleDarkMode);
        }

        // เพิ่มหมวดหมู่ลงในรายการ
        function populateCategoryList() {
            // ล้างรายการเดิม (ยกเว้น "ทั้งหมด")
            const allCategoryItem = categoryList.querySelector('.category-item[data-group="all"]');
            categoryList.innerHTML = '';
            categoryList.appendChild(allCategoryItem);
            
            // เพิ่มหมวดหมู่ใหม่
            if (groups.length === 0) {
                console.warn('No groups found to populate the category list');
            }
            
            groups.forEach(group => {
                if (!group) return; // ข้ามกรณีที่ group เป็น null หรือ undefined
                
                const li = document.createElement('li');
                li.className = 'category-item';
                li.textContent = ' ' + group;
                li.dataset.group = group;
                
                // เพิ่มไอคอนสำหรับหมวดหมู่
                const icon = document.createElement('i');
                icon.className = groupIcons[group] || 'fas fa-folder';
                li.prepend(icon);
                
                li.addEventListener('click', () => selectGroup(group));
                categoryList.appendChild(li);
            });
        }

        // จัดการการเลือกหมวดหมู่
        function selectGroup(group) {
            // อัปเดตหมวดหมู่ที่เลือก
            selectedGroup = group;
            expandedQuestionId = null;
            
            // อัปเดตคลาส active ในรายการหมวดหมู่
            document.querySelectorAll('.category-item').forEach(item => {
                if ((item.dataset.group === 'all' && group === 'all') || 
                    (item.dataset.group === group)) {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });
            
            // แสดงคำถามสำหรับหมวดหมู่ที่เลือก
            if (group === 'all') {
                showAllQuestions();
            } else {
                showGroupQuestions(group);
            }
        }

        // แสดงเนื้อหาแนะนำ
        function showIntroduction() {
            introContent.style.display = 'block';
            questionsContent.style.display = 'none';
        }

        // แสดงคำถามทั้งหมด
        function showAllQuestions() {
            introContent.style.display = 'none';
            questionsContent.style.display = 'block';
            questionsTitle.innerHTML = '<i class="fas fa-question-circle"></i> คำถามทั้งหมด';
            
            renderQuestions(questions);
        }

        // แสดงคำถามเฉพาะหมวดหมู่
        function showGroupQuestions(group) {
            introContent.style.display = 'none';
            questionsContent.style.display = 'block';
            
            // เพิ่มไอคอนสำหรับหัวข้อหมวดหมู่
            const icon = groupIcons[group] || 'fas fa-folder';
            questionsTitle.innerHTML = `<i class="${icon}"></i> คำถามเกี่ยวกับ: ${group}`;
            
            const filteredQuestions = questions.filter(q => q.group === group);
            renderQuestions(filteredQuestions);
        }

        // แสดงคำถามในคอนเทนเนอร์
        function renderQuestions(questionsToRender) {
            // ล้างคำถามที่มีอยู่
            questionsContainer.innerHTML = '';
            
            if (questionsToRender.length === 0) {
                const emptyMessage = document.createElement('p');
                emptyMessage.className = 'empty-message';
                emptyMessage.innerHTML = '<i class="fas fa-info-circle"></i> ไม่พบข้อมูลคำถามในหมวดหมู่นี้';
                questionsContainer.appendChild(emptyMessage);
                return;
            }
            
            // เพิ่มคำถามแต่ละข้อ
            questionsToRender.forEach(question => {
                const questionCard = document.createElement('div');
                questionCard.className = 'question-card';
                questionCard.id = `question-${question.id}`;
                
                const questionHeader = document.createElement('div');
                questionHeader.className = 'question-header';
                questionHeader.addEventListener('click', () => toggleQuestion(question.id));
                
                const questionTitle = document.createElement('h3');
                questionTitle.className = 'question-title';
                questionTitle.textContent = question.question;
                
                const questionIcon = document.createElement('span');
                questionIcon.className = 'question-icon';
                questionIcon.innerHTML = '<i class="fas fa-chevron-down"></i>';
                
                questionHeader.appendChild(questionTitle);
                questionHeader.appendChild(questionIcon);
                
                const questionAnswer = document.createElement('div');
                questionAnswer.className = 'question-answer';
                
                const questionAnswerContent = document.createElement('div');
                questionAnswerContent.className = 'question-answer-content';
                questionAnswerContent.innerHTML = question.answer;
                
                questionAnswer.appendChild(questionAnswerContent);
                
                questionCard.appendChild(questionHeader);
                questionCard.appendChild(questionAnswer);
                
                questionsContainer.appendChild(questionCard);
            });
        }

        // สลับการแสดงคำตอบ
        function toggleQuestion(id) {
            const questionCard = document.getElementById(`question-${id}`);
            const questionAnswer = questionCard.querySelector('.question-answer');
            const questionIcon = questionCard.querySelector('.question-icon');
            
            if (expandedQuestionId === id) {
                // ซ่อนคำถามปัจจุบัน
                questionAnswer.classList.remove('active');
                questionIcon.innerHTML = '<i class="fas fa-chevron-down"></i>';
                questionCard.classList.remove('active');
                expandedQuestionId = null;
            } else {
                // ซ่อนคำถามที่กำลังแสดงอยู่
                if (expandedQuestionId !== null) {
                    const currentExpandedCard = document.getElementById(`question-${expandedQuestionId}`);
                    if (currentExpandedCard) {
                        currentExpandedCard.querySelector('.question-answer').classList.remove('active');
                        currentExpandedCard.querySelector('.question-icon').innerHTML = '<i class="fas fa-chevron-down"></i>';
                        currentExpandedCard.classList.remove('active');
                    }
                }
                
                // แสดงคำถามที่คลิก
                questionAnswer.classList.add('active');
                questionIcon.innerHTML = '<i class="fas fa-chevron-up"></i>';
                questionCard.classList.add('active');
                expandedQuestionId = id;
            }
        }

        // สลับโหมดกลางคืน/กลางวัน
        function toggleDarkMode() {
            isDarkMode = !isDarkMode;
            document.body.classList.toggle('dark-mode', isDarkMode);
            
            // เปลี่ยนไอคอนของปุ่มสลับธีม
            themeToggle.innerHTML = isDarkMode ? 
                '<i class="fas fa-sun"></i>' : 
                '<i class="fas fa-moon"></i>';
        }

        // เพิ่ม event listener สำหรับหมวดหมู่ "ทั้งหมด"
        document.querySelector('.category-item[data-group="all"]').addEventListener('click', () => selectGroup('all'));

        // เริ่มต้นแอปพลิเคชันเมื่อโหลดหน้าเสร็จ
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
