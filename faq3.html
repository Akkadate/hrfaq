<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ระบบคำถามที่พบบ่อย - ระบบบริหารงานบุคคล</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f3f4f6;
            min-height: 100vh;
        }
        
        .container {
            display: flex;
            min-height: 100vh;
            flex-direction: column;
        }
        
        @media (min-width: 768px) {
            .container {
                flex-direction: row;
            }
        }
        
        .sidebar {
            background-color: #1f2937;
            color: white;
            padding: 1rem;
            width: 100%;
        }
        
        @media (min-width: 768px) {
            .sidebar {
                width: 25%;
            }
        }
        
        .sidebar h2 {
            font-size: 1.25rem;
            font-weight: bold;
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #4b5563;
        }
        
        .category-list {
            list-style-type: none;
        }
        
        .category-item {
            margin-bottom: 0.5rem;
            padding: 0.5rem;
            border-radius: 0.25rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .category-item:hover {
            background-color: #4b5563;
        }
        
        .category-item.active {
            background-color: #2563eb;
        }
        
        .content {
            padding: 1.5rem;
            width: 100%;
        }
        
        @media (min-width: 768px) {
            .content {
                width: 75%;
            }
        }
        
        .content h2 {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 1.5rem;
        }
        
        .intro-card {
            background-color: white;
            border-radius: 0.5rem;
            padding: 1.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .intro-card h2 {
            margin-bottom: 1rem;
        }
        
        .intro-card p {
            margin-bottom: 0.75rem;
        }
        
        .intro-info {
            margin-top: 1.5rem;
            padding: 1rem;
            background-color: #ebf5ff;
            border-radius: 0.5rem;
        }
        
        .intro-info h3 {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        .intro-info ul {
            list-style-type: disc;
            padding-left: 1.25rem;
        }
        
        .intro-info li {
            margin-bottom: 0.5rem;
        }
        
        .questions-container {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .question-card {
            background-color: white;
            border-radius: 0.5rem;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .question-header {
            padding: 1rem;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color 0.2s;
        }
        
        .question-header:hover {
            background-color: #f9fafb;
        }
        
        .question-title {
            font-size: 1.125rem;
            font-weight: 500;
        }
        
        .question-icon {
            color: #6b7280;
        }
        
        .question-answer {
            padding: 1rem;
            background-color: #f9fafb;
            border-top: 1px solid #e5e7eb;
            display: none;
        }
        
        .question-answer.active {
            display: block;
        }
        
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        
        .error {
            color: #ef4444;
            padding: 1rem;
        }
        
        .empty-message {
            color: #6b7280;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <h2>หมวดหมู่คำถาม</h2>
            <ul id="categoryList" class="category-list">
                <li class="category-item active" data-group="all">ทั้งหมด</li>
                <!-- ข้อมูลหมวดหมู่เพิ่มเติมจะถูกเพิ่มที่นี่ -->
            </ul>
        </div>
        
        <div class="content">
            <div id="loadingIndicator" class="loading">กำลังโหลดข้อมูล...</div>
            <div id="errorIndicator" class="error" style="display: none;"></div>
            <div id="contentArea" style="display: none;">
                <div id="introContent" class="intro-card">
                    <h2>ระบบบริหารงานบุคคล - คำถามที่พบบ่อย</h2>
                    <p>ยินดีต้อนรับสู่ระบบคำถามที่พบบ่อยของระบบบริหารงานบุคคล เว็บไซต์นี้ได้รวบรวมคำถามและคำตอบที่พบบ่อยเกี่ยวกับการใช้งานระบบ</p>
                    <p>กรุณาเลือกหมวดหมู่ทางด้านซ้ายเพื่อดูคำถามที่เกี่ยวข้อง</p>
                    <div class="intro-info">
                        <h3>การใช้งานเว็บไซต์</h3>
                        <ul>
                            <li>คลิกที่หมวดหมู่ในเมนูด้านซ้ายเพื่อดูคำถามในหมวดนั้น</li>
                            <li>คลิกที่คำถามเพื่อดูคำตอบโดยละเอียด</li>
                            <li>คำตอบสามารถแสดงรูปภาพ ลิงก์ และรายละเอียดอื่นๆ ได้</li>
                        </ul>
                    </div>
                </div>
                
                <div id="questionsContent" style="display: none;">
                    <h2 id="questionsTitle">คำถามทั้งหมด</h2>
                    <div id="questionsContainer" class="questions-container">
                        <!-- คำถามจะถูกเพิ่มที่นี่ -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ข้อมูลตัวอย่าง - ใช้ในกรณีที่ไม่สามารถเชื่อมต่อกับ API ได้
        const demoData = [
            {
                id: 1,
                question: "ฉันจะตรวจสอบวันลาคงเหลือของฉันได้อย่างไร?",
                answer: "คุณสามารถตรวจสอบวันลาคงเหลือได้โดยเข้าไปที่เมนู <b>ข้อมูลส่วนตัว</b> > <b>ประวัติการลา</b> ระบบจะแสดงจำนวนวันลาประเภทต่างๆ ที่คุณใช้ไปแล้วและที่เหลืออยู่ในปีปัจจุบัน",
                group: "การลางาน"
            },
            {
                id: 2,
                question: "การขออนุมัติลาล่วงหน้ามีขั้นตอนอย่างไร?",
                answer: "การขออนุมัติลาล่วงหน้ามีขั้นตอนดังนี้:<br>1. เข้าสู่ระบบ<br>2. เลือกเมนู 'ยื่นใบลา'<br>3. เลือกประเภทการลา<br>4. กรอกข้อมูลวันที่ต้องการลาและเหตุผล<br>5. กดปุ่ม 'ส่งคำขอ'<br><br>ผู้บังคับบัญชาจะได้รับการแจ้งเตือนและดำเนินการอนุมัติต่อไป",
                group: "การลางาน"
            },
            {
                id: 3,
                question: "ฉันจะอัปโหลดใบรับรองแพทย์ได้อย่างไร?",
                answer: "หลังจากยื่นใบลาป่วยในระบบแล้ว คุณสามารถอัปโหลดใบรับรองแพทย์ได้โดย:<br>1. เข้าไปที่เมนู 'ประวัติการลา'<br>2. ค้นหาและคลิกที่รายการลาป่วยที่ต้องการแนบเอกสาร<br>3. คลิกที่ปุ่ม 'อัปโหลดเอกสาร'<br>4. เลือกไฟล์ใบรับรองแพทย์จากเครื่องคอมพิวเตอร์ของคุณ (รองรับไฟล์ .pdf, .jpg, .png)<br>5. คลิกยืนยัน",
                group: "การลางาน"
            },
            {
                id: 4,
                question: "เงินเดือนของฉันจะเข้าเมื่อไหร่?",
                answer: "เงินเดือนจะเข้าบัญชีธนาคารที่ท่านแจ้งไว้ทุกวันสิ้นเดือน หากตรงกับวันหยุด จะโอนเข้าในวันทำการสุดท้ายก่อนวันสิ้นเดือน สำหรับพนักงานใหม่ที่เริ่มงานระหว่างเดือน จะได้รับเงินเดือนตามสัดส่วนวันทำงานจริง",
                group: "เงินเดือนและสวัสดิการ"
            },
            {
                id: 5,
                question: "ฉันจะดูรายละเอียดสลิปเงินเดือนได้อย่างไร?",
                answer: "คุณสามารถดูรายละเอียดสลิปเงินเดือนได้โดย:<br>1. เข้าสู่ระบบ<br>2. เลือกเมนู 'เงินเดือนและสวัสดิการ'<br>3. เลือก 'สลิปเงินเดือน'<br>4. เลือกเดือนที่ต้องการดูข้อมูล<br><br>สลิปเงินเดือนจะแสดงรายละเอียดรายรับ รายหัก และยอดสุทธิที่ได้รับ",
                group: "เงินเดือนและสวัสดิการ"
            },
            {
                id: 6,
                question: "วิธีแก้ไขข้อมูลส่วนตัวในระบบ",
                answer: "การแก้ไขข้อมูลส่วนตัวในระบบ:<br>1. เข้าสู่ระบบ<br>2. คลิกที่ชื่อผู้ใช้ของคุณที่มุมขวาบน<br>3. เลือก 'ข้อมูลส่วนตัว'<br>4. คลิกปุ่ม 'แก้ไข' ที่ข้อมูลที่ต้องการเปลี่ยนแปลง<br>5. กรอกข้อมูลใหม่<br>6. กดปุ่ม 'บันทึก'<br><br>หมายเหตุ: ข้อมูลบางประเภท เช่น เลขบัตรประชาชน หรือวันเกิด อาจไม่สามารถแก้ไขได้ด้วยตนเอง ต้องติดต่อฝ่ายทรัพยากรบุคคล",
                group: "ข้อมูลส่วนตัว"
            },
            {
                id: 7,
                question: "การเปลี่ยนรหัสผ่านทำอย่างไร?",
                answer: "การเปลี่ยนรหัสผ่านมีขั้นตอนดังนี้:<br>1. เข้าสู่ระบบ<br>2. คลิกที่ชื่อผู้ใช้ของคุณที่มุมขวาบน<br>3. เลือก 'ตั้งค่าความปลอดภัย'<br>4. เลือก 'เปลี่ยนรหัสผ่าน'<br>5. กรอกรหัสผ่านปัจจุบัน<br>6. กรอกรหัสผ่านใหม่ และยืนยันรหัสผ่านใหม่<br>7. คลิก 'บันทึก'<br><br>รหัสผ่านใหม่ต้องมีความยาวอย่างน้อย 8 ตัวอักษร ประกอบด้วยตัวอักษรภาษาอังกฤษตัวใหญ่ ตัวเล็ก ตัวเลข และอักขระพิเศษ",
                group: "ความปลอดภัยและการเข้าสู่ระบบ"
            },
            {
                id: 8,
                question: "ฉันลืมรหัสผ่าน จะทำอย่างไร?",
                answer: "หากคุณลืมรหัสผ่าน สามารถดำเนินการดังนี้:<br>1. ที่หน้าเข้าสู่ระบบ คลิก 'ลืมรหัสผ่าน'<br>2. กรอกอีเมลที่ใช้ลงทะเบียนในระบบ<br>3. คลิก 'ส่งลิงก์รีเซ็ตรหัสผ่าน'<br>4. เช็คอีเมลของคุณและคลิกลิงก์ที่ได้รับ<br>5. ตั้งรหัสผ่านใหม่ตามข้อกำหนด<br><br>หากไม่ได้รับอีเมล โปรดตรวจสอบโฟลเดอร์ 'จดหมายขยะ' หรือติดต่อฝ่ายทรัพยากรบุคคลที่เบอร์ 02-123-4567",
                group: "ความปลอดภัยและการเข้าสู่ระบบ"
            }
        ];

        // DOM Elements
        const categoryList = document.getElementById('categoryList');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const errorIndicator = document.getElementById('errorIndicator');
        const contentArea = document.getElementById('contentArea');
        const introContent = document.getElementById('introContent');
        const questionsContent = document.getElementById('questionsContent');
        const questionsTitle = document.getElementById('questionsTitle');
        const questionsContainer = document.getElementById('questionsContainer');

        // State variables
        let questions = [];
        let groups = [];
        let selectedGroup = 'all';
        let expandedQuestionId = null;
        let useLocalData = false;

        // Supabase configuration
        const supabaseUrl = 'https://ecpbvoijdtgkaabuglmw.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVjcGJ2b2lqZHRna2FhYnVnbG13Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDA4MzkzMDEsImV4cCI6MjA1NjQxNTMwMX0.391_WbnnNWxAB55h5Br4gfFu4c3m65o9x-XPIx4R-WA';

        // ทดสอบชื่อตารางต่างๆ ที่อาจเป็นไปได้
        const possibleTableNames = ['faq', 'FAQ', 'faqs', 'hr_faq', 'hr_faqs', 'hrfaq', 'qa', 'qas', 'questions'];

        // Function to test connection to Supabase
        async function testSupabaseConnection() {
            console.log('Testing Supabase connection...');
            
            // ทดสอบดูว่ามีตารางชื่ออะไรบ้างใน Supabase
            const tables = await findAvailableTables();
            
            if (tables.length > 0) {
                console.log('Available tables:', tables);
                // ลองเรียกข้อมูลจากตารางแรกที่พบ
                return tables[0];
            } else {
                throw new Error('No accessible tables found in the database');
            }
        }

        // Function to find available tables
        async function findAvailableTables() {
            const availableTables = [];
            
            for (const tableName of possibleTableNames) {
                try {
                    const testUrl = `${supabaseUrl}/rest/v1/${tableName}?limit=1`;
                    const response = await fetch(testUrl, {
                        method: 'GET',
                        headers: {
                            'apikey': supabaseKey,
                            'Authorization': `Bearer ${supabaseKey}`
                        }
                    });
                    
                    if (response.ok) {
                        console.log(`Table "${tableName}" exists and is accessible`);
                        availableTables.push(tableName);
                    }
                } catch (err) {
                    console.log(`Table "${tableName}" is not accessible:`, err);
                }
            }
            
            return availableTables;
        }

        // Function to fetch data from Supabase
        async function fetchFromSupabase(endpoint, options = {}) {
            const url = `${supabaseUrl}/rest/v1/${endpoint}`;
            const headers = {
                'apikey': supabaseKey,
                'Authorization': `Bearer ${supabaseKey}`,
                'Content-Type': 'application/json',
                'Prefer': 'return=representation',
                ...options.headers
            };

            try {
                console.log('Fetching from:', url);
                const response = await fetch(url, {
                    ...options,
                    headers
                });

                if (!response.ok) {
                    throw new Error(`Supabase API error: ${response.status} ${response.statusText}`);
                }

                const data = await response.json();
                console.log('Data fetched successfully:', data.length, 'records');
                return data;
            } catch (error) {
                console.error('Error fetching from Supabase:', error);
                throw error;
            }
        }

        // Initialize the application
        async function initApp() {
            try {
                // แสดง loading indicator
                loadingIndicator.style.display = 'flex';
                errorIndicator.style.display = 'none';
                contentArea.style.display = 'none';
                
                let tableName = '';
                
                try {
                    // ทดสอบการเชื่อมต่อและหาชื่อตารางที่ถูกต้อง
                    tableName = await testSupabaseConnection();
                    console.log(`Using table: ${tableName}`);
                    useLocalData = false;
                } catch (connectionError) {
                    console.error('Connection test failed:', connectionError);
                    console.log('Falling back to demo data');
                    useLocalData = true;
                }
                
                if (useLocalData) {
                    // ใช้ข้อมูลตัวอย่าง
                    questions = demoData;
                    console.log('Using demo data:', questions.length, 'records');
                } else {
                    // ดึงข้อมูลจาก Supabase
                    try {
                        const data = await fetchFromSupabase(tableName, {
                            method: 'GET',
                            headers: {
                                'Range': '0-999',
                                'Prefer': 'count=exact',
                            }
                        });
                        
                        questions = data || [];
                        console.log('Data loaded from Supabase:', questions);
                    } catch (fetchError) {
                        console.error('Error fetching data:', fetchError);
                        questions = demoData;
                        useLocalData = true;
                        console.log('Fallback to demo data after fetch error');
                    }
                }
                
                // ดึงกลุ่มที่ไม่ซ้ำกันจากข้อมูล
                const uniqueGroupsSet = new Set();
                questions.forEach(item => {
                    if (item.group) {
                        uniqueGroupsSet.add(item.group);
                    }
                });
                groups = Array.from(uniqueGroupsSet);
                
                console.log('Groups loaded:', groups);
                
                // ซ่อนตัวแสดงการโหลดและแสดงเนื้อหา
                loadingIndicator.style.display = 'none';
                contentArea.style.display = 'block';
                
                // อัปเดตรายการหมวดหมู่
                populateCategoryList();
                
                // แสดงคำแนะนำเริ่มต้น
                showIntroduction();
                
            } catch (err) {
                console.error('Error setting up application:', err);
                loadingIndicator.style.display = 'none';
                errorIndicator.textContent = 'เกิดข้อผิดพลาดในการโหลดข้อมูล: ' + err.message;
                errorIndicator.style.display = 'block';
            }
        }

        // เพิ่มหมวดหมู่ลงในรายการ
        function populateCategoryList() {
            // ล้างรายการเดิม (ยกเว้น "ทั้งหมด")
            const allCategoryItem = categoryList.querySelector('.category-item[data-group="all"]');
            categoryList.innerHTML = '';
            categoryList.appendChild(allCategoryItem);
            
            // เพิ่มหมวดหมู่ใหม่
            if (groups.length === 0) {
                console.warn('No groups found to populate the category list');
            }
            
            groups.forEach(group => {
                if (!group) return; // ข้ามกรณีที่ group เป็น null หรือ undefined
                
                const li = document.createElement('li');
                li.className = 'category-item';
                li.textContent = group;
                li.dataset.group = group;
                li.addEventListener('click', () => selectGroup(group));
                categoryList.appendChild(li);
            });
        }

        // จัดการการเลือกหมวดหมู่
        function selectGroup(group) {
            // อัปเดตหมวดหมู่ที่เลือก
            selectedGroup = group;
            expandedQuestionId = null;
            
            // อัปเดตคลาส active ในรายการหมวดหมู่
            document.querySelectorAll('.category-item').forEach(item => {
                if ((item.dataset.group === 'all' && group === 'all') || 
                    (item.dataset.group === group)) {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });
            
            // แสดงคำถามสำหรับหมวดหมู่ที่เลือก
            if (group === 'all') {
                showAllQuestions();
            } else {
                showGroupQuestions(group);
            }
        }

        // แสดงเนื้อหาแนะนำ
        function showIntroduction() {
            introContent.style.display = 'block';
            questionsContent.style.display = 'none';
        }

        // แสดงคำถามทั้งหมด
        function showAllQuestions() {
            introContent.style.display = 'none';
            questionsContent.style.display = 'block';
            questionsTitle.textContent = 'คำถามทั้งหมด';
            
            renderQuestions(questions);
        }

        // แสดงคำถามเฉพาะหมวดหมู่
        function showGroupQuestions(group) {
            introContent.style.display = 'none';
            questionsContent.style.display = 'block';
            questionsTitle.textContent = `คำถามเกี่ยวกับ: ${group}`;
            
            const filteredQuestions = questions.filter(q => q.group === group);
            renderQuestions(filteredQuestions);
        }

        // แสดงคำถามในคอนเทนเนอร์
        function renderQuestions(questionsToRender) {
            // ล้างคำถามที่มีอยู่
            questionsContainer.innerHTML = '';
            
            if (questionsToRender.length === 0) {
                const emptyMessage = document.createElement('p');
                emptyMessage.className = 'empty-message';
                emptyMessage.textContent = 'ไม่พบข้อมูลคำถามในหมวดหมู่นี้';
                questionsContainer.appendChild(emptyMessage);
                return;
            }
            
            // เพิ่มคำถามแต่ละข้อ
            questionsToRender.forEach(question => {
                const questionCard = document.createElement('div');
                questionCard.className = 'question-card';
                questionCard.id = `question-${question.id}`;
                
                const questionHeader = document.createElement('div');
                questionHeader.className = 'question-header';
                questionHeader.addEventListener('click', () => toggleQuestion(question.id));
                
                const questionTitle = document.createElement('h3');
                questionTitle.className = 'question-title';
                questionTitle.textContent = question.question;
                
                const questionIcon = document.createElement('span');
                questionIcon.className = 'question-icon';
                questionIcon.textContent = '▼';
                
                questionHeader.appendChild(questionTitle);
                questionHeader.appendChild(questionIcon);
                
                const questionAnswer = document.createElement('div');
                questionAnswer.className = 'question-answer';
                questionAnswer.innerHTML = question.answer;
                
                questionCard.appendChild(questionHeader);
                questionCard.appendChild(questionAnswer);
                
                questionsContainer.appendChild(questionCard);
            });
        }

        // สลับการแสดงคำตอบ
        function toggleQuestion(id) {
            const questionCard = document.getElementById(`question-${id}`);
            const questionAnswer = questionCard.querySelector('.question-answer');
            const questionIcon = questionCard.querySelector('.question-icon');
            
            if (expandedQuestionId === id) {
                // ซ่อนคำถามปัจจุบัน
                questionAnswer.classList.remove('active');
                questionIcon.textContent = '▼';
                expandedQuestionId = null;
            } else {
                // ซ่อนคำถามที่กำลังแสดงอยู่
                if (expandedQuestionId !== null) {
                    const currentExpandedCard = document.getElementById(`question-${expandedQuestionId}`);
                    if (currentExpandedCard) {
                        currentExpandedCard.querySelector('.question-answer').classList.remove('active');
                        currentExpandedCard.querySelector('.question-icon').textContent = '▼';
                    }
                }
                
                // แสดงคำถามที่คลิก
                questionAnswer.classList.add('active');
                questionIcon.textContent = '▲';
                expandedQuestionId = id;
            }
